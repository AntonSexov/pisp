# pisp
 - Ведерников Антон Владимирович, P3223
 - Вариант: ```asm | acc | harv | hw | instr | struct | stream | mem | cstr | prob2 ```
 - Упрощенный вариант
 ## Язык
 ### Форма Бэкуса-Наура
 ```endf
 <программа> ::=
	 ".data" <перенос строки> <данные> [комментарий] <перенос строки>
	 ".code" <перенос строки> "begin:" { <инструкция> | <метка> } [комментарий] <перенос строки> "end" <перенос строки> <EOF>
<данные> ::= <метка переменной>":" <переменная> [комментарий] <перенос строки>
<инструкция> ::= <адресная команда> <операнд> [комментарий] <перенос строки> | <безадресная команда> [комментарий] <перенос строки> | <команда перехода> <метка перехода> [комментарий] <перенос строки>

<команда перехода> ::= "jmp" | "jifn" | "jifnn" | "jifz" | "jifnz"
<адресная команда> ::= "load" | "store" | "add" | "sub" | "mod"
<безадресная команда> ::= "hlt" | "nop"
<операнд> ::= <число>| "&"<число> | <метка переменной> | "&"<метка переменной>
<метка перехода> ::= <идентификатор> | "&"<число>

<метка переменной> ::= <слово>
<переменная> ::= <число> | """<слово>"""

<идентификатор> ::= <слово>
<комментарий> ::= ";" {<слово> | <число>}

<перенос строки> ::= "\n"
<слово> ::= <буква> {<буква>}
<число> ::= ["-"]<цифра> {<цифра>}
<буква> ::= a | b | c | ... | z | A | B | C | ... | Z
<цифра> ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
 ```

 - Видимость данных - глобальная
 - Поддерживаются целочисленные ($-2^{31}$ до $2^{31}-1$) и строковые литералы
 - Любые символы расположенные после `;` - комментарии
 - В секции `.data` должны быть только переменные
 - В секции `.code` должны быть только команды и метки
 - Метки должны быть объявлены до применения

### Команды:
_Адресные:_  
`load` - загрузка значение из операнда или значение из ячейки памяти в аккумулятор  
`store` - выгружает значение из аккумулятора в указанную ячейку памяти  
`add` - сложение значения из операнда или значения из ячейки памяти со значением в аккумуляторе  
`sub` - вычитание значения из операнда или значения из ячейки памяти со значением в аккумуляторе  
`sub` - вычисление остатка от деления значения в аккумуляторе на значение из операнда или значение указанной ячейки память  
_Безадресные:_  
`nop` - пустышка  
`hlt` - остановить работу процессора  
_Перехода:_  
`jmp` - безусловный переход на метку или указанный адрес  
`jifz` - переход на метку или указанный адрес, при флаге Z = 1  
`jifnz` - переход на метку или указанный адрес, при флаге Z = 0  
`jifn` - переход на метку или указанный адрес, при флаге N = 1  
`jifnn` - переход на метку или указанный адрес, при флаге N = 0  
#### Метки
Метки определяются исключительно на отдельных строчках
```endf
samplelabel:
	load 5
	sub 1
	jifnz samplelabel
```
Во время трансляции `jifnz samplelabel` замениться на `jifnz &0` (при условии что `samplelabel` находиться в самом начале секции `.code`)
## Организация памяти
- Память команд и память данных разделены
- Длина машинного слова `32 бита`
- Адреса `0` и `1` в памяти данных являются адресами ввода и вывода соответственно 
```
        data memory
+----------------------------+
| 00 :  input address        |
| 01 :  output address       |
|         variables          |
|             .              |
|             .              |
|             .              |
| 2047 :       ...           |
+----------------------------+

     instruction memory
+----------------------------+
| 00 :  instruction 1        |
| 01 :  instruction 2        |
|       instructions         |
|             .              |
|             .              |
|             .              |
| 2047 :       ...           |
+----------------------------+

		   Registers
+------------------------------+
| acc                          |
| cr                           |
| ar                           |
| dr                           |
| sr                           |
+------------------------------+
```

- `in` и `out` заранее зарезервированы, то есть `load &0` эквивалентно `load in`
-  Разработчику доступны только манипуляции с памятью данных и регистром `acc` 
- #### Адресация
  - Прямая: `load 5` загрузит в аккумулятор `5`
  - Косвенная:  `load &5` загрузит в аккумулятор значение из ячейки памяти по адресу `5`
- #### Регистры
   -  Аккумулятор `acc` - используется почти во всех командах (хранение данных, вывод)
   - Регистр команд `cr` - хранит текущую инструкцию
   - Регистр адреса `ar` - хранит адрес ячейки памяти
   - Регистр данных `dr` - хранит данные для передачи в аккумулятор или память
   - Регистр статуса `sr` - хранит флаги `NZC`
     - `N` - флаг отрицательности
     - `Z` - флаг нуля
     - `С` - флаг переноса  
## Система команд
#### Особенности процессора:
 - В секции данных машинное слово - `32` бита, знаковое
 - В секции инструкций длина машинного слова - неопределена
 - Поток управления - инкремент `ip` после каждой инструкции



```
| ФИО                           | алг          | LoC | code инстр. | инстр. | такт. |
| Ведерников Антон Владимирович | cat          | 8   | 4           | 19     | 73    |
| Ведерников Антон Владимирович | hellousername| 23  | 13          | 179    | 766   |
| Ведерников Антон Владимирович | helloworld   | 15  | 8           | 80     | 344   |
| Ведерников Антон Владимирович | prob2        | 30  | 19          | 431    | 1915  |
```
```python3 runner.py <input file> <machine code file>```